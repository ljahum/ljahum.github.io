---
title: å…»æˆæ¯2021
date: 2021-09-12 00:07:00+08:00
# weight: 1000
draft: true
author: "ljahum"
description: "å…»æˆæ¯2021"
tags: 
- crypto
# crypto 25 math 6codes 5bin 4Nuil 
categories: 
- CTF
# - CTF posts notes å…¶ä»–

# å†…æ³¢æ ‡é¢˜å›¾ç‰‡
featuredImage: 

# å¤–éƒ¨æ ‡å›¾å›¾ç‰‡
featuredImagePreview: 

hiddenFromHomePage: false
math:
  enable: true
---
<!--more-->
## å…»æˆæ¯2021

> æ²¡æœ‰æŠ¥ äº‹åçœ‹äº†ä¸€ä¸‹é™„ä»¶
>
> å¯†ç é¢˜è´¨é‡æŒºæ°´çš„,åªæœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é¢˜

### RSA?

è¿™é“é¢˜æ‹¿åˆ°å°±æ˜¯ä¸€ä¸ªsageæ–‡ä»¶ï¼Œç»™äº†åŠ å¯†çš„é€»è¾‘

```python
import os

from Crypto.Util.number import *


flag = "GWHT{xxxxxxxxx}"
p = getPrime(256)
q = getPrime(256)
n = p*q
N = (p-1)*(q-1)
e = 65537
Mx = bytes_to_long(os.urandom(30))
My = bytes_to_long(flag)
Z1 = (Mx*My)%n
inv_Z1 = inverse_mod(Z1, n)
inv_2 = inverse_mod(2, n)

X = ((Z1+inv_Z1)*inv_2)%n
Y = My
inv_Y = inverse_mod(Y, n)
a = ((inv_Z1-X)*inv_Y)%n
D = (a*a)%n

xy = lambda (x1,y1),(x2,y2) : ((x1*x2+D*y1*y2)%n, (x1*y2+x2*y1)%n)

def getloop((x,y), e):
        ret = (x, y)
        for i in range(e-1):
               ret = xy(ret, (x,y))
        return ret

print n
print getloop((X, Y), e)
print a

# 13390709926509813526471364597371124446888078365567927211781799241724742352679484983709219580483800891886832613684875066109177882219522305348565532970795023
# (5404548088049249951619519701935576492239293254135836357417714329205323074367876875480850741613547220698045360461761929952847796420174204143917852624050110, 2110372753170830610718226848526649992911771424441223687775304654852191999130502986109306355582366065947895295520226816523397652918227241733632791793362785)
# 1762039418842677123086894939949574689744108610561557889235294034870342076452734215004689409493802437034960516295735815195656138656970901855976802991519141
```

ç¨å¾®åˆ†æä¸€ä¸‹æœ‰ä»¥ä¸‹å¼å­:

$X=\frac{1+M_x^2M_y^2}{2M_xM_y}$

$Y=M_y$

$a=\frac{1-M_x^2M_y^2}{2M_xM_y^2}$

$D=\frac{(1-M_x^2M_y^2)^2}{4M_x^2M_y^4}$

å¯¹getloopç¨å¾®åˆ†æä¸€ä¸‹å¯ä»¥å‘ç°

n=0æ—¶

$X_0=\frac{1+M_x^2M_y^2}{2M_xM_y}$

$Y_0=M_y$

n=1æ—¶

$X_1=\frac{1+M_x^4M_y^4}{2M_x^2M_y^2}$

$Y_1=\frac{1+M_x^2M_y^2}{M_x}$

åˆæœ‰

$Y_1a=\frac{1-M_x^4M_y^4}{2M_x^2M_y^2}$

åˆ™

$X_1-Y_1a=\frac{2M_x^4M_y^4}{2M_x^2M_y^2}=M_x^2M_y^2$

åŒç†

$X_0-Y_0a=\frac{2M_x^2M_y^2}{2M_xM_y}=M_xM_y$

ç›¸å½“äºåœ¨

```python
def getloop((x,y), e):
        ret = (x, y)
        for i in range(e-1):
               ret = xy(ret, (x,y))
        return ret
```

ä¸­

æ¯æ¬¡å¾ªç¯åéƒ½ä¼šä¹˜ä¸Š$M_yM_x$

åˆ™è§£ä¸€ä¸ªrsaå°±å®Œäº‹äº†

åœ¨è¿™ä¸ªèŠ‚éª¨ç‚¹ä¸ŠğŸ‘´æ˜¯ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¸€ä¸ªyafuå°±èƒ½æŠŠnåˆ†è§£å¼€ã€‚ã€‚ã€‚





![](https://raw.githubusercontent.com/ljahum/images/main/img/20210913191818.png)

solve

```python
import libnum, gmpy2
n = 13390709926509813526471364597371124446888078365567927211781799241724742352679484983709219580483800891886832613684875066109177882219522305348565532970795023
p = 115718235064789220654263009993128325569382592506655305434488398268608329541037
q = n//p
e = 65537
Xn, Yn = 5404548088049249951619519701935576492239293254135836357417714329205323074367876875480850741613547220698045360461761929952847796420174204143917852624050110, 2110372753170830610718226848526649992911771424441223687775304654852191999130502986109306355582366065947895295520226816523397652918227241733632791793362785
a = 1762039418842677123086894939949574689744108610561557889235294034870342076452734215004689409493802437034960516295735815195656138656970901855976802991519141
 
c = (Xn - Yn * a)%n
d = gmpy2.invert(e,(p-1)*(q-1))
xy = pow(c,d,n)
 
flag = ((1-xy*xy)*gmpy2.invert(2,n)*gmpy2.invert(xy,n)*gmpy2.invert(a,n))%n
print(libnum.n2s(flag))
```

`GWHT{pell_equation_is_very_interesting}`

